varnishtest "no-op test"

varnish v1 -vcl+backend {
vcl 4.1;
	import riscv;
	import std;

	backend default none;

	sub vcl_init {
		new riscv_backend = riscv.init(max_instructions = 2000000);
	}

	sub vcl_recv {
		std.cache_req_body(15MB);
		return (hash);
	}

	sub vcl_backend_fetch {
		set bereq.backend = riscv_backend.from_body();
		return (fetch);
	}
} -start

client c1 {
	txreq -url "/exec" -body "mirror"
	rxresp
	expect resp.http.X-exception == "Not an ELF binary"
	txreq -url "/" -body "testing 123"
	rxresp
	expect resp.http.X-exception == "Not an ELF binary"
} -run
